syntax = "proto3";

package user.v1;

import "google/protobuf/timestamp.proto";

// UserService defines the gRPC service for managing users.
service UserService {
  // rpc to get user by email
  rpc GetUserByEmail(Email) returns (User) {}
  // rpc to get user by id
  rpc GetUserById(Id) returns (User) {}
  // rpc to create a new user
  rpc CreateUser(CreateUserRequest) returns (User) {}
  // rpc to update an existing user
  rpc UpdateUser(UpdateUserRequest) returns (User) {}
  // rpc to delete a user by id
  rpc DeleteUser(Id) returns (StatusResponse) {}
  // rpc to ban a user by id
  rpc BanUser(BanUserRequest) returns (User) {}
  // rpc to unban a user by id
  rpc UnbanUser(Id) returns (User) {}
  // rpc to confirm user password
  rpc ConfirmPassword(PasswordRequest) returns (StatusResponse) {}
  // rpc to change user password
  rpc ChangePassword(PasswordRequest) returns (StatusResponse) {}
}

message User {
  string id = 1;
  optional string name = 2;
  string email = 3;
  optional string phone_number = 4;
  string role = 5;
  optional string avatar_url = 6;
  string password_hash = 7;
  bool is_email_verified = 8;
  optional google.protobuf.Timestamp last_login = 9; 
  bool is_banned = 10;
  optional string ban_reason = 11;
  optional google.protobuf.Timestamp banned_at = 12;
  google.protobuf.Timestamp created_at = 13;
  google.protobuf.Timestamp updated_at = 14;
}

// declaration of Id message
message Id {
  string id = 1;
}
// declaration of Email message
message Email {
  string email = 1;
}
// Message representing a status response
message StatusResponse {
  bool success = 1;
  string message = 2;
}

// Message for creating a new user
message CreateUserRequest {
  string email = 1;
  string password_hash = 2;
  optional string name = 3;
  optional string phone_number = 4;
  optional string avatar_url = 5;
}

// Message for updating an existing user
message UpdateUserRequest {
  string id = 1;
  optional string name = 2;
  optional string phone_number = 3;
  optional string avatar_url = 4;
}

// Message for banning a user
message BanUserRequest {
  string id = 1;
  optional string reason = 2;
}

// Message for password related requests
message PasswordRequest {
  string id = 1;
  string password = 2;
}

// Command to generate TypeScript code with NestJS options, using null for optional fields and Date for timestamps
// protoc -I ./proto ./proto/user.proto --ts_proto_out=./src/generated-types --ts_proto_opt=nestJs=true --ts_proto_opt=useNullAsOptional=true --ts_proto_opt=useDate=true